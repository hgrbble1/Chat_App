<!DOCTYPE html>

<head>
  <title>Mustache Messaging App</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<header>
</header>
<main>
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">Welcome To the Mustache Messaging App</span>
          <p>Upload your file, message, or even an image and we will send it for you. </p>
          <p>But first we need you to tell us the Ip address or addresses this file is going to</p>
          <p>If you are adding more than one Ip adress please input the ipaddress like so:</p>
          <br>
          <p><strong>Ipaddress1,Ipaddress2,Ipaddress3...etc</strong></p>
        </div>
        <div class="card-action">
          <div class="row">
            <div class="input-field col s12">
              <input id="ip_address" type="text">
              <label class="active" for="first_name2">Ip Adresses</label>
              <a id="ipButton" class="waves-effect waves-light btn"><i class="material-icons right">send</i>Add Ip(s)</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const CSV = require('csv-types').CSV;
    var target = [];
    var electron = require('electron');
    const {  ipcRenderer  } = electron;
    const button = document.querySelector('#ipButton');
    button.addEventListener('click', sendIps);

    function sendIps(e) {
      e.preventDefault();

      const input = document.querySelector("#ip_address");
      var ipAddresses = input.value;
      let lcsv = new CSV({
        headers: false
      });
      //ipaddresses = "233.445.66,6645.67.89";
      ipaddressArray = lcsv.parse(input.value);
      console.log(ipaddressArray);
      for (var i = 0; i < ipaddressArray.values[0].length; i++ ) {
        //JSON object
        var jsonObject = {
          "port": 3333,
          "address": ipaddressArray.values[0][i]
        };
          target.push(jsonObject);
      }

      console.log(target);

      ipcRenderer.send("target:initialize", target);

    }


    // var filepath;
    // var filename;
    // var app = require('electron').remote;
    // var dialog = app.dialog;
    // const electron = require('electron');
    // const {
    //   ipcRenderer
    // } = electron;
    // const file = document.querySelector('#attach');
    // file.addEventListener('click', uploadFile);
    // const sendButton = document.querySelector('#send');
    // sendButton.addEventListener('click', sendFile);
    //
    // function uploadFile(e) {
    //   e.preventDefault();
    //   dialog.showOpenDialog((fileNames) => {
    //     // fileNames is an array that contains all the selected
    //     if (fileNames === undefined) {
    //       console.log("No file selected");
    //       return;
    //     }
    //     // var url = window.location.pathname;
    //     // var filename = url.substring(url.lastIndexOf('/')+1);
    //     // alert(filename);
    //     console.log(fileNames[0]);
    //     filepath = fileNames[0];
    //     filename = filepath.substring(filepath.lastIndexOf('\\') + 1);
    //     console.log(filename);
    //   });
    // };
    //
    // function sendFile(e) {
    //   e.preventDefault();
    //   console.log('hello form the sendFile funciton');
    //   ipcRenderer.send('file:upload', filepath, filename);
    // };
  </script>
</main>
<footer>
</footer>
<!-- <body>
<h1>Hello from the upload</h1>
</body> -->
